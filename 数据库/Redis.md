# Redis

## 什么是Redis？
一个高性能的缓存数据库，支持字符串、列表、哈希、集合等类型，支持持久化到磁盘，支持Lua脚本、发布订阅、自动故障转移等。可用于热点数据缓存等场景。

## Redis与Memcached有什么区别？
回答这个问题前，我们至少要知道Redis和Memcached是什么，各自的使用场景，以及为什么。那么什么事Memcached呢？
### 什么事memcached？
memcached 是一个内存数据库，仅支持key-value类型，不支持数据持久化到磁盘。
那么对比redis和memcache可以得出以下结论：
- 相同点：
    - 数据都在内存中操作
    - 读写性能高
- 不同点：
    - redis支持持久化，memcached不支持
    - redis支持哈希、列表、集合等类型，memcache不支持
    - redis支持发布订阅，lua脚本等，memcached不支持等

## 为什么使用Redis作为Mysql缓存？
- 高性能：内存读写，性能高
- 高并发：性能高带来了高QPS，自然相对Mysql来说并发支持更高

## Redis数据类型


### string 字符串类型
数据结构为简单动态字符串SDS，及存储二进制数据、字符串长度熟悉。SDS是安全的，字符串拼接不会造成缓冲区溢出，因为拼接之前SDS会检测空间知否足够，不够会自动扩容。类似结构
```golang
type string struct {
    data unsafe.Pinter // []int
    len int
}
```


### list 列表
底层是快速链表quicklist(双压缩ziplist)


### hash 哈希表



## 场景问题

### Redis的list底层数据结构是什么

### Redis的hash表是如何解决hash冲突的

### 你都支付项目中为什么用list，而不用发布订阅？


### 你的支付项目中为什么用hash表存储订单状态信息？有没有考虑过数据量超出hash的容量范围的问题？

### 你的支付项目中是如何生成订单号的？
雪花算法

### 多节点中你是如何保证队列消费安全的？
使用redis的 redis.call方法调用lua脚本实现的原子加锁和释放锁，创建全局唯一锁，哪个节点拿到这个锁了哪个节点来执行消费，消费完毕后在释放掉这个锁。

#### 那如果并发量上来了，其他节点不就成了摆设了吗？现在需要你提升这个服务的性能，怎么设计？
将队列进行拆分，有几个节点拆分成几个队列，生产者写入时用轮询写入保证每个节点的队列数据数量基本一致，消费时，各个节点只消费自己这个节点的队列数据。考虑极端情况可以在增加一个全局的调度器和全局队列来协调各个队列的消费情况，避免某一个节点挂掉后这个节点的队列数据停止消费问题。